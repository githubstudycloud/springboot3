# 平台数据采集框架 (platform-collect) 开发指南

请基于DDD和六边形架构设计原则，实现一个灵活、可扩展的数据采集框架，支持多源数据采集、转换和加载，作为整个平台的数据基础设施。特别注重业务模块的分离与可选装配，实现关注点分离和功能隔离。

## 核心需求

1. 设计统一的数据采集框架，支持批量和实时两种采集模式
2. 实现可扩展的连接器系统，支持关系型数据库、NoSQL、API、XML、文件系统等多种数据源
3. 提供数据采集任务的配置、调度和监控功能
4. 实现数据采集过程中的转换和预处理能力
5. 设计参数管理系统，支持多样化的采集参数配置和版本管理
6. 实现与数据治理模块的集成，在采集流程中嵌入数据清洗能力
7. 支持采集规则的版本化管理，包括项目、版本和条件组合的灵活配置
8. 实现高级增量采集机制，支持多字段组合水印跟踪

## 模块化设计要求

1. 将数据采集框架拆分为核心模块和多个可选业务模块:
   - platform-collect-core: 核心框架，定义接口和通用功能
   - platform-collect-connectors: 数据源连接器集合
     - platform-collect-api: API数据源连接器
     - platform-collect-xml: XML数据源连接器
     - platform-collect-rdbms: 关系型数据库连接器
     - platform-collect-mongodb: MongoDB连接器
   - platform-collect-processors: 数据处理器集合
     - platform-collect-filter: 数据过滤处理器
     - platform-collect-transform: 数据转换处理器
     - platform-collect-validator: 数据验证处理器
   - platform-collect-loaders: 数据加载器集合
     - platform-collect-mongo-loader: MongoDB加载器
     - platform-collect-db-loader: 数据库加载器
   - platform-collect-admin: 管理界面和API

2. 采集流水线设计:
   - 定义统一的采集流水线抽象，支持多阶段数据处理
   - 支持可插拔的处理节点，包括数据获取、字段映射、数据转换、数据清洗、数据加载等
   - 实现流水线状态监控和错误恢复机制
   - 支持分布式执行和并行处理

## 采集规则设计

1. 多层次规则组织:
   - 系统(System): 对应一个数据源系统
   - 项目(Project): 系统中的业务项目
   - 版本(Version): 项目的不同版本
   - 采集模式(CollectMode): 全量/增量/部分
   - 选择条件(SelectionCriteria): 基于责任人/时间/类别等过滤

2. 复杂API采集场景支持:
   - 两阶段采集模式(ID列表+详情批量获取)
   - 批量请求优化，支持动态批量大小(100-300)
   - 请求重试和错误恢复机制
   - 高级分页策略支持

3. 增量采集设计:
   - 多字段水印管理(修改时间、移动时间等)
   - 特殊条件处理(ID不变但路径变化的移动情况)
   - 灵活的增量策略配置
   - 水印存储和恢复机制

4. 灵活的条件组合:
   - 支持条件的布尔组合(AND, OR, NOT)
   - 支持嵌套条件表达式
   - 支持动态条件评估

## 技术要求

1. 使用Spring Boot 3.x作为基础框架，结合Spring Boot Starter机制实现模块自动装配
2. 采用Maven/Gradle多模块项目结构，子模块间通过接口依赖
3. 使用SPI机制实现插件化架构，便于扩展新的数据源连接器
4. 设计适配器模式支持连接器的可替换性，允许将HTTP连接器替换为其他同步工具
5. 通过标准接口复用平台统一定时器(platform-scheduler)，不重新实现调度功能
6. 实现两阶段数据处理模式，支持MongoDB中间存储和数据库最终加载
7. 设计完善的错误处理和重试机制，支持失败记录跟踪和数据恢复

## 与其他模块集成

1. 与调度系统(platform-scheduler)集成:
   - 设计采集任务适配器，注册为平台调度任务
   - 实现基于事件的任务触发机制
   - 支持调度参数的传递和转换

2. 与数据治理模块(platform-data-governance)集成:
   - 在采集流程中调用数据清洗规则
   - 自动注册采集的元数据
   - 收集数据质量指标
   - 实现数据血缘追踪

## 重点关注能力

1. 复杂数据源参数管理:
   - 支持字段选择性采集
   - 支持版本化采集参数
   - 支持参数模板和继承

2. 两阶段采集流程:
   - ID阶段: 获取对象ID列表
   - 详情阶段: 批量获取详情数据
   - 支持ID去重和合并

3. 增量采集细化:
   - 支持基于时间戳的增量
   - 支持基于路径变化的增量
   - 支持记录级别的增量控制

4. 数据源切换能力:
   - 设计标准连接器接口
   - 支持连接器热插拔
   - 实现连接配置迁移工具

5. 错误处理和恢复:
   - 支持任务级、阶段级、记录级错误处理
   - 实现优雅降级策略
   - 支持使用上一组成功数据作为备选

## 交付内容

1. 完整的多模块项目结构和构建配置
2. 核心模块的领域模型和接口定义
3. 至少实现3种常用数据源的连接器
4. 完整的流水线实现和错误处理机制
5. 与调度系统和数据治理模块的集成实现
6. 详细的设计文档和示例代码

请在开发过程中，特别关注规则和参数的灵活性设计，确保能够处理复杂的采集场景，如多版本、多条件组合、批量API调用和精细化增量控制。同时，确保与平台现有的统一定时器良好集成，避免重复实现调度功能。
