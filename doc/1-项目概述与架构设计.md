# 项目概述与架构设计

## 1. 项目背景

本项目是一个基于SpringBoot 3.x和Vue 3.x的全栈微服务平台，采用DDD（领域驱动设计）和六边形架构（端口与适配器）设计原则。该平台提供了一套完整的微服务基础架构，包括服务注册与发现、配置中心、API网关、统一认证授权等核心功能。

## 2. 技术栈

### 2.1 后端技术栈
- **核心框架**: Java 21, SpringBoot 3.2.1
- **微服务框架**: Spring Cloud 2023.0.0, Spring Cloud Alibaba 2022.0.0.0
- **持久层**: MyBatis 3.0.2 + XML, MongoDB 4.11.1
- **数据库**: MySQL 8.0.33, Redis 7.x
- **消息队列**: Kafka 3.5.1, RabbitMQ 2.4.2
- **服务治理**: Nacos (服务注册/发现/配置中心)

### 2.2 前端技术栈
- **核心框架**: Vue 3.x
- **UI组件库**: 待定
- **状态管理**: 待定
- **路由**: 待定

### 2.3 DevOps工具链
- **构建工具**: Maven 3.8+
- **CI/CD**: 待实现
- **代码质量**: 计划使用SonarQube
- **监控**: 自研监控仪表板

## 3. 总体架构

```mermaid
graph TB
    Client[客户端] --> Gateway[API网关]
    Gateway --> Auth[认证授权服务]
    Gateway --> ServiceA[微服务A]
    Gateway --> ServiceB[微服务B]
    Gateway --> ServiceC[微服务C]
    
    subgraph 基础设施服务
        Registry[服务注册中心]
        Config[配置中心]
        Monitor[监控仪表板]
    end
    
    ServiceA --> Registry
    ServiceB --> Registry
    ServiceC --> Registry
    Auth --> Registry
    Gateway --> Registry
    
    ServiceA --> Config
    ServiceB --> Config
    ServiceC --> Config
    Auth --> Config
    Gateway --> Config
    
    ServiceA --> Monitor
    ServiceB --> Monitor
    ServiceC --> Monitor
    Auth --> Monitor
    Gateway --> Monitor
    
    subgraph 数据存储
        MySQL[(MySQL)]
        Redis[(Redis)]
        MongoDB[(MongoDB)]
    end
    
    ServiceA --> MySQL
    ServiceB --> MongoDB
    ServiceC --> Redis
```

## 4. 项目模块结构

当前项目由以下核心模块组成：

```mermaid
graph TB
    Parent[platform-parent] --> Dependency[platform-dependency]
    Parent --> Common[platform-common]
    Parent --> Registry[platform-registry]
    Parent --> Gateway[platform-gateway]
    Parent --> Auth[platform-auth-service]
    Parent --> Config[platform-config]
    Parent --> Monitor[platform-monitor-dashboard]
    Parent --> Scheduler[platform-scheduler]
    Parent --> DataViz[platform-data-visualization]
    
    subgraph 核心基础设施
        Dependency
        Common
        Registry
        Gateway
        Auth
        Config
    end
    
    subgraph 业务功能模块
        Scheduler
        DataViz
        Monitor
    end
```

## 5. 设计原则

### 5.1 框架与业务隔离

- **领域模型与框架无关**: 领域实体、值对象等不应继承或依赖任何框架类
- **接口隔离**: 使用抽象接口隔离基础设施实现细节
- **核心业务独立性**: 核心业务逻辑不包含框架API调用
- **防腐层**: 创建防腐层保护领域模型免受外部影响

### 5.2 领域驱动设计(DDD)实践

```mermaid
graph LR
    A[战略设计] --> B[限界上下文]
    A --> C[上下文映射]
    A --> D[通用语言]
    A --> E[子域划分]
    
    F[战术设计] --> G[实体]
    F --> H[值对象]
    F --> I[聚合]
    F --> J[聚合根]
    F --> K[仓储]
    F --> L[领域服务]
    F --> M[领域事件]
```

- **战略设计与战术设计分离**: 明确区分业务建模和技术实现
- **限界上下文**: 明确划分业务边界
- **上下文映射**: 定义子域间关系
- **统一语言**: 确保业务术语一致性

### 5.3 六边形架构(端口与适配器)

```mermaid
graph TB
    A[外部系统] --> B[输入适配器]
    B --> C[输入端口]
    C --> D[应用核心/领域层]
    D --> E[输出端口]
    E --> F[输出适配器]
    F --> G[外部资源/基础设施]
```

- **核心领域集中**: 核心领域逻辑位于中心，与外部技术实现隔离
- **端口定义交互**: 通过端口定义领域与外部世界的交互契约
- **适配器实现集成**: 使用适配器实现与外部系统的集成
- **输入/输出适配器区分**: 明确区分面向用户的输入适配器和面向基础设施的输出适配器

## 6. 代码分层

```mermaid
graph TB
    A[表示层] --> B[应用层]
    B --> C[领域层]
    C --> D[基础设施层]
    
    subgraph 表示层
        A1[Controllers]
        A2[DTOs]
        A3[Assemblers]
    end
    
    subgraph 应用层
        B1[Application Services]
        B2[Command/Query Handlers]
        B3[Event Handlers]
    end
    
    subgraph 领域层
        C1[Domain Models]
        C2[Domain Services]
        C3[Domain Events]
        C4[Repository Interfaces]
    end
    
    subgraph 基础设施层
        D1[Repository Implementations]
        D2[Persistence Adapters]
        D3[External Service Adapters]
        D4[Message Queue Adapters]
    end
```

## 7. 当前状态与挑战

系统目前正处于初期开发阶段，已完成的模块包括：
- 服务注册中心
- 配置中心
- 监控仪表板
- 调度系统的部分功能

面临的主要挑战：
1. 需要完善分布式链路追踪
2. 需要集成ELK日志系统
3. 需要实现分布式事务支持
4. 需要添加全局数据加密解密方案
5. CI/CD流程尚未建立

## 8. 重构目标

本次重构的主要目标是：
1. 统一架构风格，确保所有模块遵循DDD和六边形架构
2. 改进代码组织结构，提高可维护性
3. 完善基础设施服务
4. 优化性能瓶颈
5. 提高系统弹性和可靠性 